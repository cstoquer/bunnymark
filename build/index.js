!function s(o,a,h){function u(e,t){if(!a[e]){if(!o[e]){var r="function"==typeof require&&require;if(!t&&r)return r(e,!0);if(l)return l(e,!0);var i=new Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}var n=a[e]={exports:{}};o[e][0].call(n.exports,function(t){return u(o[e][1][t]||t)},n,n.exports,s,o,a,h)}return a[e].exports}for(var l="function"==typeof require&&require,t=0;t<h.length;t++)u(h[t]);return u}({1:[function(t,e,r){"use strict";var o=/rgba?\(\s*([.0-9]+)\s*,\s*([.0-9]+)\s*,\s*([.0-9]+)\s*,?\s*([.0-9]+)?\s*\)/;function i(){this.r=0,this.g=0,this.b=0,this.a=void 0,this.string=""}(e.exports=i).prototype._setRGB=function(t,e,r){this.r=t,this.g=e,this.b=r},i.prototype.fromPixel=function(t,e){var r=t[e+0],i=t[e+1],n=t[e+2];return this.string="rgb("+r+","+i+","+n+")",this._setRGB(r,i,n),this},i.prototype.fromString=function(t){var e,r,i,n=(this.string=t).match(o);if(n)e=~~n[1],r=~~n[2],i=~~n[3],this._setRGB(e,r,i);else{var s="0x"+t.slice(1).replace(t.length<5&&/./g,"$&$&");this._setRGB(s>>16,s>>8&255,255&s)}return this},i.prototype.fromRGB=function(t,e,r){return this._setRGB(t,e,r),this.string="rgb("+t+","+e+","+r+")",this},i.prototype.fromColor=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this.string=t.string,this}},{}],2:[function(t,e,r){"use strict";var i=t("./index"),n=t("../domUtils/createCanvas"),u=8,l=8,m=Math.PI/2;i.setTileSize=function(t,e){u=~~t,l=~~e},i.prototype._init=function(){this.canvas=n(this.width,this.height),this.ctx=this.canvas.getContext("2d"),this.ctx.fillStyle=this.palette[0].string,this.ctx.strokeStyle=this.palette[1].string,this.resize(this.width,this.height)},i.prototype.resize=function(t,e){return this.canvas.width=this.width=t,this.canvas.height=this.height=e,this.clear(),this},i.prototype.sprite=function(t,e,r,i,n,s){var o=u*(t%16),a=l*~~(t/16),h=this.ctx;return e=e||0,r=r||0,e=~~Math.round(e-this.camera.x),r=~~Math.round(r-this.camera.y),i||n||s?(h.save(),i&&(h.scale(-1,1),e=-e-u),n&&(h.scale(1,-1),r=-r-l),s?(h.translate(e+l,r),h.rotate(m)):h.translate(e,r),h.drawImage(this.tilesheet,this.ox+o,this.oy+a,u,l,0,0,u,l),h.restore()):h.drawImage(this.tilesheet,this.ox+o,this.oy+a,u,l,e,r,u,l),this},i.prototype.draw=function(t,e,r,i,n,s){var o=i||n||s;if(t._isSprite){var a=t;t=a.img;var h=a.x,u=a.y,l=a.width,c=a.height,p=~~Math.round((e||0)-this.camera.x),f=~~Math.round((r||0)-this.camera.y);return o?((d=this.ctx).save(),s?(i&&(d.scale(-1,1),p*=-1,p-=c),n&&(d.scale(1,-1),f*=-1,f-=l),d.translate(p+c,f),d.rotate(m)):(i&&(d.scale(-1,1),p*=-1,p-=l),n&&(d.scale(1,-1),f*=-1,f-=c),d.translate(p,f)),d.drawImage(t,h,u,l,c,0,0,l,c),d.restore(),this):(this.ctx.drawImage(t,h,u,l,c,p,f,l,c),this)}t._isTileMap&&(t.texture||t._prepareTexture(),t=t.texture.canvas),t._isTexture&&(t=t.canvas);var d;p=~~Math.round((e||0)-this.camera.x),f=~~Math.round((r||0)-this.camera.y);return o?((d=this.ctx).save(),s?(i&&(d.scale(-1,1),p*=-1,p-=t.height),n&&(d.scale(1,-1),f*=-1,f-=t.width),d.translate(p+t.height,f),d.rotate(m)):(i&&(d.scale(-1,1),p*=-1,p-=t.width),n&&(d.scale(1,-1),f*=-1,f-=t.height),d.translate(p,f)),d.drawImage(t,0,0),d.restore()):this.ctx.drawImage(t,p,f),this},i.prototype.clear=function(){return this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this},i.prototype.cls=function(){return this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this},i.prototype.pen=function(t){return this._pen=t%this.palette.length,this.ctx.strokeStyle=this.palette[this._pen].string,this},i.prototype.paper=function(t){return this._paper=t%this.palette.length,this.ctx.fillStyle=this.palette[this._paper].string,this},i.prototype.rect=function(t,e,r,i){if(r<=1||i<=1){var n=this.ctx.fillStyle;return this.ctx.fillStyle=this.ctx.strokeStyle,this.ctx.fillRect(~~(t-this.camera.x),~~(e-this.camera.y),~~r,~~i),this.ctx.fillStyle=n,this}return this.ctx.strokeRect(.5+~~(t-this.camera.x),.5+~~(e-this.camera.y),~~(r-1),~~(i-1)),this},i.prototype.rectf=function(t,e,r,i){return this.ctx.fillRect(~~(t-this.camera.x),~~(e-this.camera.y),~~r,~~i),this},i.prototype.rectfill=i.prototype.rectf,i.prototype._isTexture=!0,i.prototype.tilesheet=n(16*u,16*l)},{"../domUtils/createCanvas":7,"./index":3}],3:[function(t,e,r){"use strict";function i(t,e){this.width=t,this.height=e,this.camera={x:0,y:0},this._cursor={i:0,j:0},this._paper=0,this._pen=1,this._init()}function n(t,e){t.ox=0,t.oy=0,e._isImageWrapper&&(e=e.asset),e._isSprite?(t.ox=e.x,t.oy=e.y,t.tilesheet=e.img):e._isMap?(e.texture||e._prepareTexture(),t.tilesheet=e.texture.canvas):e._isTexture?t.tilesheet=e.canvas:(e instanceof Image||e instanceof HTMLCanvasElement)&&(t.tilesheet=e)}(e.exports=i).prototype.palette=[{string:"#000000",r:0,g:0,b:0},{string:"#FFFFFF",r:1,g:1,b:1}],i.prototype.ox=0,i.prototype.oy=0,i.setTileSize=function(){},i.prototype.setPalette=function(t){i.prototype.palette=t},i.prototype.setGlobalTilesheet=function(t){n(i.prototype,t)},i.prototype.setTilesheet=function(t){if(t)return n(this,t),this;delete this.tilesheet},i.prototype.setCamera=function(t,e){return this.camera.x=t||0,this.camera.y=e||0,this}},{}],4:[function(t,e,r){"use strict";function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var i=t("./index.js"),u=3,l=5,n=i.prototype.setPalette;i.prototype.setPalette=function(t){n.call(this,t),i.prototype.textCharset=new i(128*u,l*t.length),function(t,e){for(var r=[219,438,511,14016,14043,14326,14335,28032,28123,28086,28159,32704,32731,32758,32767,128,146,384,402,9344,9362,9600,9618,192,210,448,466,9408,9426,9664,9682,32767,0,8338,45,11962,5588,21157,29354,10,17556,5265,21973,1488,5312,448,13824,5268,31599,29843,29671,31143,18925,31183,31689,18735,31727,18927,1040,5136,17492,3640,5393,8359,25450,23530,31467,25166,15211,29391,4815,27470,23533,29847,15142,23277,29257,23421,23403,11114,4843,26474,23279,14798,9367,27501,12141,24429,23213,14829,29351,25750,17553,13459,9402,28672,34,23530,31467,25166,15211,29391,4815,27470,23533,29847,15142,23277,29257,23421,23403,11114,4843,26474,23279,14798,9367,27501,12141,24429,23213,14829,29351,25686,9362,13587,42,21845],i=0;i<e.length;i++){t.fillStyle=e[i].string;for(var n=0;n<r.length;n++)for(var s=r[n],o=0;o<15;o++){var a=o%u,h=~~(o/u);1==(s>>o&1)&&t.fillRect(n*u+a,i*l+h,1,1)}}t.fillStyle=e[0].string}(i.prototype.textCharset.ctx,t)};var o=i.prototype.resize;i.prototype.resize=function(t,e){return this._textOffset=1,this._textColumn=~~(t/4),this._textLine=~~(e/6),this._textPadding=e-6*this._textLine-this._textOffset,this._cursor.i=0,this._cursor.j=0,o.call(this,t,e),this},i.prototype.cls=function(){return this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.locate(0,0),this},i.prototype.textCharset=new i(128*u,l*i.prototype.palette.length),i.prototype.locate=function(t,e){return this._cursor.i=~~t,this._cursor.j=~~e,this},i.prototype.print=function(e,t,r){if("object"===s(e))try{e=JSON.stringify(e)}catch(t){e="[Object]"}else"string"!=typeof e&&(e=e.toString());if(void 0!==t){t=~~Math.round(t-this.camera.x),r=~~Math.round(r-this.camera.y);for(var i=0;i<e.length;i++)this.ctx.drawImage(this.textCharset.canvas,u*e.charCodeAt(i),l*this._pen,u,l,t,r,u,l),t+=4;return this}for(i=0;i<e.length;i++){this._cursor.j>=this._textLine&&this.textScroll();var n=e.charCodeAt(i);10!==n&&13!==n?(this.ctx.drawImage(this.textCharset.canvas,u*n,l*this._pen,u,l,4*this._cursor.i,6*this._cursor.j+this._textOffset,u,l),this._cursor.i+=1,this._cursor.i>this._textColumn&&(this._cursor.i=0,this._cursor.j+=1)):(this._cursor.i=0,this._cursor.j+=1)}return this},i.prototype.println=function(t){return this.print(t),this.print("\n"),this},i.prototype.textScroll=function(t){return void 0===t&&(t=1),this._cursor.j-=t,t*=6,this.ctx.drawImage(this.canvas,0,-t),this.ctx.fillRect(0,this.canvas.height-t-this._textPadding,this.canvas.width,t+this._textPadding),this}},{"./index.js":3}],5:[function(t,e,r){"use strict";var i=t("../Texture"),n=t(".."),u=8,l=8;function c(t,e,r,i,n,s,o,a){this.x=~~t,this.y=~~e,this.sprite=~~r,this.flipH=!!i,this.flipV=!!n,this.flipR=!!s,this.flagA=!!o,this.flagB=!!a}function s(t,e){this._name="",this.width=0,this.height=0,this.items=[],this.texture=null,this.tilesheet=null,this._tilesheetPath="",t&&e&&this._init(t,e)}(e.exports=s).prototype._isTileMap=!0;var a,f,o={},h=[];s.getMap=function(t){return"string"==typeof t?o[t]:"number"==typeof t?h[t]:(console.error("Map does not exist",t),null)},s._checkBankFormat=function(t){return t?Array.isArray(t)?{_type:"maps",maps:t}:"maps"!==t._type?(console.warn("Map bank format incorrect"),{_type:"maps",maps:[]}):t:{_type:"maps",maps:[]}},s.loadBank=function(t){t=s._checkBankFormat(t),o={},h=[];for(var e=t.maps||[],r=0;r<e.length;r++)h.push((new s).load(e[r]))},s.setTileSize=function(t,e){u=~~t,l=~~e},Object.defineProperty(s.prototype,"name",{get:function(){return this._name},set:function(t){this._name&&o[this._name]&&o[this._name]===this&&delete o[this._name],(this._name=t)&&!o[t]&&(o[t]=this)}}),s.prototype._init=function(t,e){this.width=t,this.height=e,this.items=[];for(var r=0;r<t;r++){this.items.push([]);for(var i=0;i<e;i++)this.items[r][i]=null}this.texture&&this.texture.resize(t*u,e*l)},s.prototype.resize=function(t,e){var r=this.items,i=Math.min(this.width,t),n=Math.min(this.height,e);this._init(t,e);for(var s=0;s<i;s++)for(var o=0;o<n;o++)this.items[s][o]=r[s][o];return this.redraw(),this},s.prototype.set=function(t,e,r,i,n,s,o,a){if(null==r)return this.remove(t,e);if(!(t<0||e<0||t>=this.width||e>=this.height)){var h=this.items[t][e]=new c(t,e,r,i,n,s,o,a);return this.texture&&(this.texture.ctx.clearRect(t*u,e*l,u,l),this.texture.sprite(h.sprite,h.x*u,h.y*l,h.flipH,h.flipV,h.flipR)),this}},s.prototype.remove=function(t,e){if(!(t<0||e<0||t>=this.width||e>=this.height))return this.items[t][e]=null,this.texture&&this.texture.ctx.clearRect(t*u,e*l,u,l),this},s.prototype.get=function(t,e){return t<0||e<0||t>=this.width||e>=this.height?null:this.items[t][e]},s.prototype.redraw=function(){if(!this.texture)return this;this.texture.clear();for(var t=0;t<this.width;t++)for(var e=0;e<this.height;e++){var r=this.items[t][e];r&&this.texture.sprite(r.sprite,r.x*u,r.y*l,r.flipH,r.flipV,r.flipR)}return this},s.prototype._prepareTexture=function(){this.texture=new i(this.width*u,this.height*l),this.texture.setTilesheet(this.tilesheet),this.redraw()},s.prototype.release=function(){this.texture=null},s.prototype.draw=function(t,e){this.texture||this._prepareTexture(),draw(this.texture,t,e)},s.prototype.setTilesheet=function(t){return this.tilesheet=t,this._tilesheetPath=t&&t.path||"",this.texture&&(this.texture.setTilesheet(t),this.redraw()),this},s.prototype._setTilesheetPath=function(t){if(this._tilesheetPath=t||"",!t)return this.setTilesheet();for(var e=t.split("/"),r=n.assets||{},i=0;i<e.length;i++)if(!(r=r[e[i]]))return console.warn("Could not find tilesheet",t);this.setTilesheet(r)},function(){for(var r="#$%&'()*+,-~/0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[]^_`abcdefghijklmnopqrstuvwxyz{|}. !",u={},t=0;t<r.length;t++)u[r[t]]=t;var l=r.length,c=l*l-1,p=Math.pow(2,13),s=c-p-1;function o(t){var e=t%l;return r[~~(t/l)]+r[e]}a=function(t){for(var e="",r=0,i=0;i<t.length;i++){var n=t[i];n===t[i+1]&&++r<s||(null===n&&(n=c),e+=o(n),r===s&&r--,0!==r&&(e+=o(p+r)),r=0)}return r===s&&r--,0!==r&&(e+=o(p+r)),e},f=function(t){for(var e=[],r=0;r<t.length;){var i=t[r++],n=t[r++],s=u[i]*l+u[n];if(s===c)e.push(null);else if(p<s)for(var o=s-p,a=e[e.length-1],h=0;h<o;h++)e.push(a);else e.push(s)}return e}}(),s.prototype.save=function(){for(var t=this.width,e=this.height,r=new Array(t*e),i=0;i<t;i++)for(var n=0;n<e;n++){var s=this.items[i][n];r[i+n*t]=s?s.sprite+(s.flipH<<8)+(s.flipV<<9)+(s.flipR<<10)+(s.flagA<<11)+(s.flagB<<12):null}return{w:t,h:e,name:this.name,sheet:this._tilesheetPath||"",data:a(r)}},s.prototype.load=function(t){this.texture=null;var e=t.w,r=t.h;this._init(e,r),this.name=t.name||"",this._setTilesheetPath(t.sheet);for(var i=f(t.data),n=0;n<e;n++)for(var s=0;s<r;s++){var o=i[n+s*e];if(null!==o){var a=255&o,h=o>>8&1,u=o>>9&1,l=o>>10&1,c=o>>11&1,p=o>>12&1;this.set(n,s,a,h,u,l,c,p)}}return this},s.prototype.copy=function(t,e,r,i){t=t||0,e=e||0,null==r&&(r=this.width),null==i&&(i=this.height);var n=new s(r,i);return n.paste(this,-t,-e),n},s.prototype.paste=function(t,e,r,i){e=e||0,r=r||0;for(var n=Math.min(t.width,this.width-e),s=Math.min(t.height,this.height-r),o=Math.max(0,-e),a=Math.max(0,-r),h=o;h<n;h++)for(var u=a;u<s;u++){var l=t.items[h][u];if(l)this.set(h+e,u+r,l.sprite,l.flipH,l.flipV,l.flipR,l.flagA,l.flagB);else{if(i)continue;this.remove(h+e,u+r)}}return this},s.prototype.clear=function(){for(var t=0;t<this.width;t++)for(var e=0;e<this.height;e++)this.items[t][e]=null;return this.texture&&this.texture.clear(),this},s.prototype.find=function(t,e,r){if(null===t)return this._findNull();void 0===e&&(e=null),void 0===r&&(r=null);for(var i=[],n=0;n<this.width;n++)for(var s=0;s<this.height;s++){var o=this.items[n][s];if(o){var a=null===e||o.flagA===e,h=null===r||o.flagB===r;o.sprite===t&&a&&h&&i.push(o)}}return i},s.prototype._findNull=function(){for(var t=[],e=0;e<this.width;e++)for(var r=0;r<this.height;r++)null===this.items[e][r]&&t.push({x:e,y:r});return t}},{"..":10,"../Texture":3}],6:[function(t,e,r){"use strict";function f(t,e){var r=new Image;r.onload=function(){this.onload=null,this.onerror=null,e&&e(null,this)},r.onerror=function(){this.onload=null,this.onerror=null,e&&e("img:"+t)},r.src=t}function d(t,e){var r=new Audio;function i(){e&&e(null,r),r.removeEventListener("canplaythrough",i),r.removeEventListener("error",n)}function n(){e&&e("snd:load"),r.removeEventListener("canplaythrough",i),r.removeEventListener("error",n)}r.preload=!0,r.loop=!1,r.addEventListener("canplaythrough",i),r.addEventListener("error",n),r.src=t,r.load()}r.loadData=function(t,e,r){var i=new XMLHttpRequest;i.responseType=e||"arraybuffer",i.onreadystatechange=function(){if(4==~~i.readyState)return 200!=~~i.status&&0!=~~i.status?r&&r("xhrError:"+i.status):r&&r(null,i.response)},i.open("GET",t,!0),i.send()},r.loadJson=function(t,e){var r=new XMLHttpRequest;r.onreadystatechange=function(){if(4==~~r.readyState)return 200!=~~r.status?e("xhrError:"+r.status):e&&e(null,JSON.parse(r.response))},r.open("GET",t,!0),r.send()},r.loadImage=f,r.loadSound=d,r.preloadStaticAssets=function(i,n,s){var a=i.dat,o=i.img.length,h=o+i.snd.length,u=i.root,l=0,c=0;function p(){var r,t,e=l+c;s&&s(l,e,h,e/h),t=e<o?(r=i.img[e],f):(r=i.snd[e-o],d),c+=1,t(u+r,function(t,e){t||function(t,e){var r=t.split("/"),i=r.pop().split(".");i.pop(),i=i.join(".");for(var n=a,s=0,o=r.length;s<o;s++)n=n[r[s]];n[i]=e,r.push(i),e.name=i,e.path=r.join("/")}(r,e),(l+=1)+--c<h?p():0===c&&n(null,a)})}if(0===h)return n(null,a);for(var t=Math.min(5,h-1),e=0;e<=t;e++)p()}},{}],7:[function(t,e,r){"use strict";e.exports=function(t,e){var r=document.createElement("canvas");return r.width=t,r.height=e,r}},{}],8:[function(t,e,r){"use strict";var n=document.body;function i(e,t){var r=document;rect=e.getBoundingClientRect();var i=t.clientX-rect.left,n=t.clientY-rect.top;function s(t){t.preventDefault(),e.style.left=t.clientX-i+"px",e.style.top=t.clientY-n+"px"}r.addEventListener("mousemove",s,!1),r.addEventListener("mouseup",function t(e){e.preventDefault(),r.removeEventListener("mouseup",t),r.removeEventListener("mousemove",s)},!1)}r.createDom=function(t,e,r){r=r||n;var i=document.createElement(t);return r.appendChild(i),e&&(i.className=e),i},r.createDiv=function(t,e){return r.createDom("div",t,e)},r.removeDom=function(t,e){(e=e||n).removeChild(t)},r.makeClickable=function(e,r){return e.addEventListener("mousedown",function(t){t.stopPropagation(),t.preventDefault(),r.call(e,t)}),e},r.makeDragable=function(t,e){return e=e||t,t.addEventListener("mousedown",function(t){t.stopPropagation(),t.preventDefault(),i(e,t)}),t},r.addCss=function(t){var e=document.createElement("style");e.type="text/css";var r=document.createTextNode(t);return e.appendChild(r),document.head.appendChild(e),e},r.addCssRef=function(t){var e=document.createElement("link");return e.href=t,e.rel="stylesheet",e.type="text/css",document.head.appendChild(e),e}},{}],9:[function(t,e,r){"use strict";var c=["A","B","X","Y","lb","rb","lt","rt","back","start","lp","rp","up","down","left","right"],i=!(!navigator||!navigator.getGamepads),p=!1,f=.2;function n(){this.available=!1,this.btn={},this.btnp={},this.btnr={},this.x=0,this.y=0,this.z=0,this.w=0,this.lt=0,this.rt=0,this._setupButtons()}n.prototype._setupButtons=function(){for(var t=0;t<c.length;t++){var e=c[t];this.btn[e]=!1,this.btnp[e]=!1,this.btnr[e]=!1}};var d=[new n,new n,new n,new n,window],s=new n;var o=i?function(){for(var t=navigator.getGamepads(),e=0;e<4;e++){var r=t[e],i=d[e];if(r){var n,s,o,a;i.available=!0,p&&(n=i.btn.right,s=i.btn.left,a=i.btn.down,o=i.btn.up);for(var h=0;h<c.length;h++){var u=c[h],l=r.buttons[h].pressed;i.btnp[u]=!i.btn[u]&&l,i.btnr[u]=i.btn[u]&&!l,i.btn[u]=l}i.x=r.axes[0],i.y=r.axes[1],i.z=r.axes[2],i.w=r.axes[3],i.lt=r.buttons[6].value,i.rt=r.buttons[7].value,p&&(i.btn.right=i.btn.right||i.x>f,i.btn.left=i.btn.left||i.x<-f,i.btn.down=i.btn.down||i.y>f,i.btn.up=i.btn.up||i.y<-f,i.btnp.right=i.btn.right&&!n,i.btnp.left=i.btn.left&&!s,i.btnp.down=i.btn.down&&!a,i.btnp.up=i.btn.up&&!o,i.btnr.right=!i.btn.right&&n,i.btnr.left=!i.btn.left&&s,i.btnr.down=!i.btn.down&&a,i.btnr.up=!i.btn.up&&o)}else i.available=!1}return d}:function(){return d};r.mapAnalogStickToDpad=function(t){p=!0,f=void 0===t?.3:t},r.update=function(){window.gamepads=o(),window.gamepad=function(){for(var t=0;t<c.length;t++){var e=c[t];s.btnp[e]=btnp[e]||d[0].btnp[e]||d[1].btnp[e]||d[2].btnp[e]||d[3].btnp[e],s.btnr[e]=btnr[e]||d[0].btnr[e]||d[1].btnr[e]||d[2].btnr[e]||d[3].btnr[e],s.btn[e]=btn[e]||d[0].btn[e]||d[1].btn[e]||d[2].btn[e]||d[3].btn[e]}return s.btn.up&&s.btn.down&&(s.btn.down=!1),s.btn.right&&s.btn.left&&(s.btn.left=!1),s}()}},{}],10:[function(t,e,r){"use strict";e.exports={}},{}],11:[function(t,e,r){"use strict";e.exports=function(t,e){t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}},{}],12:[function(t,e,r){"use strict";var l=t("./screenGL"),i=t("./shaders"),c=32768;function n(){this.program=i.tilepoint,this.vertex=new Float32Array(2*c),this.vertexBuffer=gl.createBuffer(),l.useProgram(this.program)}n.prototype.tiles=function(t,e){for(var r=e.length,i=Math.ceil(r/c),n=0,s=0;s<i;s++){for(var o=Math.min(c,r-n),a=0;a<o;a++)this.vertex[2*a]=e[n+a].x,this.vertex[2*a+1]=e[n+a].y;gl.bindBuffer(gl.ARRAY_BUFFER,this.vertexBuffer),gl.bufferData(gl.ARRAY_BUFFER,this.vertex,gl.STATIC_DRAW);var h=gl.getAttribLocation(this.program,"a_coordinates");gl.enableVertexAttribArray(h),gl.vertexAttribPointer(h,2,gl.FLOAT,!1,8,0),l.bindTexture(t,0);var u=gl.getUniformLocation(this.program,"u_texture");gl.uniform1i(u,0),gl.drawArrays(gl.POINTS,0,o),n+=c}},e.exports=new n},{"./screenGL":14,"./shaders":15}],13:[function(t,e,r){"use strict";var i=t("./Renderer"),n=t("pixelbox/domUtils"),s=.04,o=[],a=0,h=new Stats;h.domElement.className="stats",document.body.appendChild(h.domElement);var u=n.createDiv("bunniesCounter",h.domElement);function l(){this.x=2*(Math.random()-.5),this.y=2*(Math.random()-.5),this.sx=(Math.random()-.5)*s,this.sy=(Math.random()-.5)*s}function c(t){for(var e=0;e<t;e++)o.push(new l);a+=t,u.innerText="bunnies: "+a}c(2),r.update=function(){gl.clearColor(.4,.4,.4,1),gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT);for(var t=0;t<a;t++){var e=o[t];e.x+=e.sx,e.y+=e.sy,(1<e.x&&0<e.sx||e.x<-1&&e.sx<0)&&(e.sx*=-1),(1<e.y&&0<e.sy||e.y<-1&&e.sy<0)&&(e.sy*=-1)}i.tiles(assets.bunny,o),btn.A&&c(997),h.update()}},{"./Renderer":12,"pixelbox/domUtils":8}],14:[function(t,e,r){"use strict";var i=t("pixelbox/domUtils"),n=settings.screen.width,s=settings.screen.height,o=settings.screen.pixelSize.width||settings.screen.pixelSize[0],a=settings.screen.pixelSize.height||settings.screen.pixelSize[1];i.removeDom($screen.canvas);var h=i.createDom("canvas");h.width=n,h.height=s,h.style.width=n*o+"px",h.style.height=s*a+"px";var u=h.getContext("webgl",{antialias:!1});u.viewport(0,0,h.width,h.height),u.disable(u.BLEND),u.disable(u.DEPTH_TEST),u.depthMask(!1);function l(){this.gl=u,this.program=null}window.gl=u,l.prototype.useProgram=function(t){if(this.program===t)return t;if(null!==this.program){var e=u.getProgramParameter(this.program,u.ACTIVE_ATTRIBUTES),r=u.getProgramParameter(t,u.ACTIVE_ATTRIBUTES);if(e<r)for(var i=e;i<r;i++)u.enableVertexAttribArray(i);else if(r<e)for(i=r;i<e;i++)u.disableVertexAttribArray(i)}return this.program=t,u.useProgram(t),t},l.prototype.bindTexture=function(t,e){var r,i=(r=t)._glTexture?r._glTexture:(texture=u.createTexture(),u.bindTexture(u.TEXTURE_2D,texture),u.pixelStorei(u.UNPACK_ALIGNMENT,!0),u.texImage2D(u.TEXTURE_2D,0,u.RGBA,u.RGBA,u.UNSIGNED_BYTE,r),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.NEAREST),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.NEAREST),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE),r._glTexture=texture,texture);u.activeTexture(u.TEXTURE0+e),u.bindTexture(u.TEXTURE_2D,i)},e.exports=window.$screen=new l},{"pixelbox/domUtils":8}],15:[function(t,e,r){"use strict";var s=t("./screenGL").gl;function o(t,e){var r=s.createShader(e);if(s.shaderSource(r,t),s.compileShader(r),!s.getShaderParameter(r,s.COMPILE_STATUS))throw new Error(s.getShaderInfoLog(r));return r}function i(t,e){var r=o(t,s.VERTEX_SHADER),i=o(e,s.FRAGMENT_SHADER),n=s.createProgram();if(s.attachShader(n,r),s.attachShader(n,i),s.linkProgram(n),!s.getProgramParameter(n,s.LINK_STATUS))throw new Error(s.getProgramInfoLog(n));return n}var n={};for(var a in assets.shaders){var h=assets.shaders[a];n[a]=i(h.vert,h.frag)}e.exports=n},{"./screenGL":14}],16:[function(d,t,e){"use strict";var r,i,c=d("."),n={dat:{bunny:null,tilesheet:null,maps:{_type:"maps",maps:[{w:16,h:16,name:"map",sheet:"",data:"###$#%#&#'#(#)#*#+#,#-#~#/#0#1#2#3#4#5#6#7#8#9#:#;#<#=#>#?#@#A#B#C#D#E#F#G#H#I#J#K#L#M#N#O#P#Q#R%Y%Z%[%]%^%_%`%a%b%c%d%e%f%g%h%i!!|[#$#%#$!!|,$g|,!!|D#2!!|8#3#4|,#5!!|/$`!!|0#C#D|,#E!!|/##|,!!|,##!!|,#C#D|,#E!!|~##|-!!|,##|,!!#C#D|,#E!!|-##|~!!|,##|,#7|6!!|,#7|,#G|6!!|,#G|,"}]},shaders:{tilepoint:{frag:"precision mediump float;\n\nuniform sampler2D u_texture;\n\nvoid main(void) {\n\tvec4 color = texture2D(u_texture, gl_PointCoord);\n\tif (color.a == 0.0) discard;\n\tgl_FragColor = color;\n}",vert:"attribute vec2 a_coordinates;\n\nvoid main(void) {\n\tgl_Position  = vec4(a_coordinates.x, a_coordinates.y, 0.0, 1.0);\n\tgl_PointSize = 16.0;\n}"}}},root:"assets/",img:["bunny.png","tilesheet.png"],snd:[],settings:{name:"bunnymark",version:"2.0.2",screen:{width:900,height:500,pixelSize:{width:1,height:1},fullscreen:!0,resizable:!0},tileSize:{width:8,height:8},palette:{colors:["#000000","#FFF1E8","#008751","#AB5236","#7E2553","#5F574F","#29ADFF","#00E756","#FFA300","#FF77A8","#C2C3C7","#83769C","#FFFF27","#FFCCAA","#1D2B53","#FF004D"]},controls:{up:38,down:40,left:37,right:39,A:32,B:88},touchEvent:{multiTouch:!1,disableContextMenu:!1,hideMousePointer:!1},loader:{colors:["#FFF1E8","#000000"],custom:""},appid:"cPiatxf9V2CKye92",gamepad:{}}},m=c.settings=n.settings,s=d("./assetLoader");function o(){r.resume(),document.body.removeEventListener("mousedown",o),document.body.removeEventListener("touchstart",o)}c.inherits=d("./inherits"),c.setFullScreen=function(){},r=null,i=window.AudioContext||window.webkitAudioContext,window.AudioContext=window.webkitAudioContext=function(){return r||(r=new i,document.body.addEventListener("mousedown",o),document.body.addEventListener("touchstart",o),r)};var a=c.btn={},h=c.btnp={},u=c.btnr={},l={},p=[],f=0;function g(){for(var t=0;t<f;t++)h[p[t]]=!1,u[p[t]]=!1}function v(t,e){var r=l[t];r&&(e&&!a[r]&&(h[r]=!0),!e&&a[r]&&(u[r]=!0),a[r]=e)}!function(){var t=m.controls||{up:38,down:40,left:37,right:39,A:32,B:88};for(var e in t)l[t[e]]=e,a[e]=!1,h[e]=!1,u[e]=!1,p.push(e);f=p.length}(),window.addEventListener("keydown",function(t){t.preventDefault(),t.repeat||v(t.keyCode,!0)}),window.addEventListener("keyup",function(t){t.preventDefault(),v(t.keyCode,!1)}),c.chr$=function(t){return String.fromCharCode(t)},c.clamp=function(t,e,r){return Math.max(e,Math.min(r,t))},c.random=function(t,e){return void 0===e?~~(t*Math.random()):~~(t+Math.random()*(e-t))};var x=d("./Texture"),y=d("./TileMap");d("./Texture/canvas2D"),d("./Texture/textCanvas2D");var w=m.tileSize.width,b=m.tileSize.height;x.setTileSize(w,b),y.setTileSize(w,b),c.texture=function(t){var e=new x(t.width,t.height);return e.clear().draw(t,0,0),e},c.tilesheet=function(t){return x.prototype.setGlobalTilesheet(t)};var _=function(){var t=m.screen,h=t.width,u=t.height,l=t.pixelSize,e=c.$screen=new x(h,u),r=e.canvas,i=r.style;if(document.body.appendChild(r),t.fullscreen)if(t.keepAspectRatio){var n=function(){var t=window.innerWidth,e=window.innerHeight,r=h*l.width,i=u*l.height,n=Math.min(t/r,e/i),s=r*n,o=i*n,a=c.$screen.canvas.style;a.width=s+"px",a.height=o+"px",a.left=(t-s)/2+"px",a.top=(e-o)/2+"px"};addEventListener("resize",n),n()}else i.width=i.height="100%";else i.width=h*l.width+"px",i.height=u*l.height+"px";return e}();c.cls=function(){return _.cls()},c.sprite=function(t,e,r,i,n,s){return _.sprite(t,e,r,i,n,s)},c.draw=function(t,e,r,i,n,s){return _.draw(t,e,r,i,n,s)},c.rect=function(t,e,r,i){return _.rect(t,e,r,i)},c.rectf=function(t,e,r,i){return _.rectf(t,e,r,i)},c.camera=function(t,e){return _.setCamera(t,e)},c.pen=function(t){return _.pen(t)},c.paper=function(t){return _.paper(t)},c.locate=function(t,e){return _.locate(t,e)},c.print=function(t,e,r){return _.print(t,e,r)},c.println=function(t){return _.println(t)},c.getMap=y.getMap,c.rectfill=c.rectf;var T=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1/60)};window.frameId=0;var E=~~(m.screen.width/2),S=~~(m.screen.width/4),A=~~(m.screen.height/2);var C=["#000","#FFF"],R=m.loader&&m.loader.colors||m.loaderColors||C;Array.isArray(R)||(R=C);var F=d("./Color");_.setPalette([(new F).fromString(R[0]),(new F).fromString(R[1])]),_.paper(0).cls().paper(1).pen(1).rect(E-S-2,A-4,2*S+4,8),s.preloadStaticAssets(n,function(t,f){if(_.paper(0).pen(1).cls(),t)return console.error(t),void print(t);for(var e in c.assets=f,c)window[e]=c[e];(function(){var t=d("./Color"),e=m.palette;if(e.file){for(var r=e.file.split("/"),i=f;i&&r.length;)i=i[r.shift()];if(!i)return;var n=i.width,s=i.height,o=i.x||0,a=i.y||0;i._isSprite&&(i=i.img);var h=d("./domUtils/createCanvas")(n,s).getContext("2d");h.drawImage(i,o,a,n,s,0,0,n,s);for(var u=h.getImageData(0,0,n,s).data,l=[],c=0;c<u.length;c+=4)u[c+3]<=1||l.push((new t).fromPixel(u,c));_.setPalette(l)}else{var p;for(p=e.colors?e.colors:e,l=[],c=0;c<p.length;c++)l.push((new t).fromString(p[c]));_.setPalette(l)}})(),f.tilesheet&&c.tilesheet(f.tilesheet),y.loadBank(f.maps);var r=d("./gamepad"),i=m.gamepad||{};i.analogToDpad&&r.mapAnalogStickToDpad(i.deadZone);var n=d("../../src/main.js");n.update&&(g(),function t(){window.frameId+=1,r.update(),n.update(),g(),T(t)}())},function(t,e,r,i){_.rect(E-S-2,A-4,2*S+4,8).rectf(E-S,A-2,~~(i*S*2),4)})},{".":10,"../../src/main.js":13,"./Color":1,"./Texture":3,"./Texture/canvas2D":2,"./Texture/textCanvas2D":4,"./TileMap":5,"./assetLoader":6,"./domUtils/createCanvas":7,"./gamepad":9,"./inherits":11}]},{},[16]);